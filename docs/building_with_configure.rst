Building PyQt5 with :program:`configure.py`
===========================================

.. program:: configure.py

Prior to the release of SIP v5 the only way to build PyQt5 (and related
projects) was based on a :program:`configure.py` script.  This method is now
deprecated and will be removed when SIP v6 is released (which is expected to be
mid-2020).

:program:`configure.py` supports both SIP v4 and SIP v5.  Therefore you can
move to SIP v5 without needing to change the way you build PyQt5 at the same
time.


Installing Prerequisites
------------------------

SIP
...

SIP v4 or SIP v5 must be installed before building and using PyQt5.  If you are
using SIP v5 you can simply install it using :program:`pip`.

If you are using SIP v4 then you must build it from the source package from
https://www.riverbankcomputing.com/software/sip/download.

.. note::
    When building PyQt5 v5.11 or later you must configure SIP v4 to create a
    private copy of the ``sip`` module using a command line similar to the
    following::

        python configure.py --sip-module PyQt5.sip

    If you already have SIP v4 installed and you just want to build and install
    the private copy of the module then add the ``--no-tools`` option.


Building PyQt5
--------------

Downloading
...........

Starting with PyQt5 v5.14.0 the GPL source packages can be downloaded from the
`PyQt5 <https://pypi.org/project/PyQt5/>`__ project at PyPI.  You can download
earlier releases from
https://www.riverbankcomputing.com/software/pyqt/download5.

If you are using the commercial version of PyQt5 then you should use the
download instructions which were sent to you when you made your purchase.  You
must also download your ``pyqt-commercial.sip`` license file.


Configuring
...........

After unpacking the source package you should then check for any
:file:`README` files that relate to your platform.

If you are using the commercial version of PyQt5 then you must copy your
:file:`pyqt-commercial.sip` license file to the :file:`sip` directory, or to
the directory specified by the
:option:`--license-dir <configure.py --license-dir>` option of
:program:`configure.py`.

You need to make sure your environment variables are set properly for your
development environment.

In order to configure the build of PyQt5 you need to run the
:program:`configure.py` script as follows::

    python3 configure.py

This assumes that the Python interpreter is on your path.  Something like the
following may be appropriate on Windows::

    c:\Python38\python configure.py

If you have multiple versions of Python installed then make sure you use the
interpreter for which you wish to build PyQt5 for.

The full set of command line options is:

.. option:: -h, --help

    Display a help message and exit.

.. option:: --abi-version VERSION

    .. versionadded:: 5.12.3

    The :sip:ref:`~PyQt5.sip` module implements a versioned ABI and PyQt5 must
    be built to use a combatible version.  The ABI version has a major number
    and a minor number separated by ``.``.  The ABI version used by PyQt5 must
    have the same major number and a minor number no larger than the minor
    number implemented by the :sip:ref:`~PyQt5.sip` module.  By default PyQt5
    will use the latest ABI version.  The option is ignored unless SIP v5 is
    being used.

.. option:: --allow-sip-warnings

    .. versionadded:: 5.9.1

    Normally any warning message generated by the SIP code generator is treated
    as an error.  This option causes warning messages to be considered
    non-fatal.  It is normally only required if a later version of the code
    generator is being used that has deprecated a feature used by this version
    of PyQt5.

.. option:: --assume-shared

    Normally Qt is checked to see if it has been built as shared libraries.
    Some Linux distributions configure their Qt builds to make this check
    unreliable.  This option ignores the result of the check and assumes that
    Qt has been built as shared libraries.

.. option:: --bindir DIR

    The :program:`pyuic5`, :program:`pyrcc5` and :program:`pylupdate5`
    utilities will be installed in the directory ``DIR``.

.. option:: --concatenate

    The C++ source files for a Python module will be concatenated.  This
    results in significantly reduced compilation times.  Most, but not all,
    C++ compilers can handle the large files that result.  See also the
    :option:`--concatenate-split` option.

.. option:: --concatenate-split N

    If the :option:`--concatenate` option is used to concatenate the C++ source
    files then this option determines how many files are created.  The default
    is 1.

.. option:: --configuration FILE

    ``FILE`` contains the configuration of the PyQt5 build to be used instead
    of dynamically introspecting the system and is typically used when
    cross-compiling.  See :ref:`ref-configuration-files`.

.. option:: --confirm-license

    Using this confirms that you accept the terms of the PyQt5 license.  If it
    is omitted then you will be asked for confirmation during configuration.

.. option:: --dbus DIR

    The :file:`dbus-python.h` header file of the dbus-python package can be
    found in the directory ``DIR/dbus``.

.. option:: --debug

    The PyQt5 modules will be built with debugging symbols.  On Windows
    :program:`configure.py` must be run using a debug version of Python.

.. option:: --designer-plugindir DIR

    The Python plugin for Qt Designer will be installed in the directory
    ``DIR``.

.. option:: --destdir DIR

    The PyQt5 Python package will be installed in the directory ``DIR``.  The
    default is the Python installation's :file:`site-packages` directory.  If
    you use this option then the :envvar:`PYTHONPATH` environment variable must
    include ``DIR``.

.. option:: --disable MODULE

    .. versionadded:: 5.5.1

    Normally all PyQt5 modules are enabled and are built if the corresponding
    Qt library can be found.  This option will suppress the check for
    ``MODULE``.  The option may be specified any number of times.

.. option:: --disable-feature FEATURE

    .. versionadded:: 5.10.1

    A PyQt5 module may be configured differently depending on the corresponding
    Qt configuration.  This takes the form of a set of features that may be
    disabled.  Normally this is determined automatically.  This option will
    explicitly disable the ``FEATURE`` feature.  The option may be specified
    any number of times.

.. option:: --enable MODULE

    Normally all PyQt5 modules are enabled and are built if the corresponding
    Qt library can be found.  Using this option only those modules specifically
    enabled will be built.  The option may be specified any number of times.
    Note that using this option suppresses the checks that are normally made to
    determine how the module should be configured, i.e. which features should
    be disabled.

.. option:: --license-dir DIR

    The license files needed by the commercial version of PyQt5 can be found in
    the directory ``DIR``.

.. option:: --link-full-dll

    .. versionadded:: 5.8

    On Windows the full Python API and the limited API (as used by PyQt) are
    implemented in different DLLs.  Normally the limited DLL is linked (unless
    a debug version of the Python interpreter is being used to run 
    :program:`configure.py`).  This option forces the full API DLL to be linked
    instead.

.. option:: --no-designer-plugin

    The Qt Designer plugin will not be built.

.. option:: --no-dist-info

    .. versionadded:: 5.11

    This disables the creation of the PEP 376 :file:`.dist-info` directory.
    Starting with this version a :file:`.dist-info` directory is created.  This
    contains meta-data about the installation including version information for
    dependent packages.  It also means that :program:`pip` can be used to
    uninstall the package.

.. option:: --no-docstrings

    The PyQt5 modules will not contain automatically generated docstrings.

.. option:: --no-python-dbus

    The Qt support for the standard Python DBus bindings is disabled.

.. option:: --no-qml-plugin

    The :program:`qmlscene` plugin will not be built.

.. option:: --no-qsci-api

    The :file:`PyQt5.api` QScintilla API file is not installed even if
    QScintilla does appear to be installed.

.. option:: --no-sip-files

    The :file:`.sip` files for the PyQt5 modules will not be installed.

.. option:: --no-stubs

    .. versionadded:: 5.6

    The PEP 484 type hint stub files for the PyQt5 modules will not be
    installed.  This option is ignored (and the stub files are not installed)
    for versions of Python earlier than v3.5.

.. option:: --no-tools

    .. versionadded:: 5.3

    The :program:`pyuic5`, :program:`pyrcc5` and :program:`pylupdate5` tools
    will not be built.

.. option:: --no-timestamp

    Normally the header comments of each generated C/C++ source file includes
    a timestamp corresponding to when the file was generated.  This option
    suppresses the inclusion of the timestamp.

.. option:: --protected-is-public

    On certain platforms the size of PyQt5 modules can be significantly reduced
    by redefining the C++ ``protected`` keyword as ``public`` during
    compilation.  This option enables this behaviour and is the default on
    Linux and macOS.

.. option:: --protected-not-public

    The default redefinition of ``protected`` to ``public`` during compilation
    on Linux and macOS is disabled.

.. option:: --pyuic5-interpreter FILE

    ``FILE`` is the name of the Python interpreter used in the
    :program:`pyuic5` wrapper.  The default is platform dependent.

.. option:: --qmake FILE

    Qt's :program:`qmake` program is used to determine how your Qt installation
    is laid out.  Normally :program:`qmake` is found on your :envvar:`PATH`.
    This option can be used to specify a particular instance of
    :program:`qmake` to use.

.. option:: --qml-debug

    .. versionadded:: 5.8

    Enable the QML debugging infrastructure.  This should not be enabled in a
    production environment.

.. option:: --qml-plugindir DIR

    The Python plugin for :program:`qmlscene` will be installed in the
    directory ``DIR``.

.. option:: --qsci-api

    The :file:`PyQt5.api` QScintilla API file is installed even if QScintilla
    does not appear to be installed.  This option is implied if the
    :option:`--qsci-api-destdir` option is specified.

.. option:: --qsci-api-destdir DIR

    The QScintilla API file will be installed in the :file:`python`
    subdirectory of the :file:`api` subdirectory of the directory ``DIR``.

.. option:: --qtconf-prefix DIR

    .. versionadded:: 5.6

    A :file:`qt.conf` file is embedded in the :sip:ref:`PyQt5.QtCore` module
    with ``Prefix`` set to ``DIR`` which is assumed to be relative to the
    directory that the :sip:ref:`PyQt5.QtCore` module will be installed in.

.. option:: --sip FILE

    The SIP code generator is used to generate PyQt5's C++ source code.
    Normally the code genertor is found on your :envvar:`PATH`.  This option
    can be used to specify a particular instance of the code genertor to use.

.. option:: --sip-incdir DIR

    The :file:`sip.h` header file can be found in the directory ``DIR``.

.. option:: --sipdir DIR

    The :file:`.sip` files for the PyQt5 modules will be installed in the
    directory ``DIR``.

.. option:: --spec SPEC

    The argument ``-spec SPEC`` will be passed to :program:`qmake`.  The
    default behaviour is platform specific.  On Windows :program:`configure.py`
    will choose the value that is correct for the version of Python that is
    being used.  (However if you have built Python yourself then you may need
    to explicitly specify ``SPEC``.)  On macOS :program:`configure.py` will try
    and avoid ``macx-xcode`` if possible.

.. option:: --static

    The PyQt5 modules will be built as static libraries.  This is useful when
    building a custom interpreter with the PyQt5 modules built in to the
    interpreter.

.. option:: --stubsdir DIR

    .. versionadded:: 5.6

    The PEP 484 type hint stub files for the PyQt5 modules will be installed in
    the directory ``DIR``.  By default they will be stored in the same
    directory where (by default) the corresponding extension modules would be
    installed.  This option is ignored (and the stub files are not installed)
    for versions of Python earlier than v3.5.

.. option:: --sysroot DIR

    .. versionadded:: 5.3

    ``DIR`` is the name of an optional directory that replaces ``sys.prefix``
    in the names of other directories (specifically those specifying where the
    various PyQt5 components will be installed and where the Python include and
    library directories can be found).  It is typically used when
    cross-compiling or when building a static version of PyQt5.  See
    :ref:`ref-configuration-files`.

.. option:: --target-py-version VERSION

    .. versionadded:: 5.3

    ``VERSION`` is the major and minor version (e.g. ``3.4``) of the version of
    Python being targetted.  By default the version of Python being used to run
    the :program:`configure.py` script is used.  It is typically used when
    cross-compiling.  See :ref:`ref-configuration-files`.

.. option:: --trace

    The generated PyQt5 modules contain additional tracing code that is enabled
    using SIP's :func:`sip.settracemask` function.

.. option:: --verbose

    Compiler commands and any output issued during configuration is displayed
    instead of being suppressed.  Use this if :program:`configure.py` is having
    problems to see what exactly is going wrong.

.. option:: --version

    Display the version number and exit.

Any remaining command line arguments are expected to be in the form
``name=value`` or ``name+=value``.  Such arguments are added to any
:program:`qmake` :file:`.pro` file created by :program:`configure.py`.


Building and Installing
.......................

The next step is to build PyQt5 by running your platform's :program:`make`
command.  For example::

    make

The final step is to install PyQt5 by running the following command::

    make install

(Depending on your system you may require root or administrator privileges.)

This will install the various PyQt5 components.


.. _ref-configuration-files:

Configuring with Configuration Files
....................................

The :program:`configure.py` script normally introspects the Python installation
of the interpreter running it in order to determine the names of the various
files and directories it needs.  This is fine for a native build of PyQt5 but
isn't appropriate when cross-compiling.  In this case it is possible to supply
a configuration file, specified using the :option:`--configuration` option,
which contains definitions of all the required values.

A configuration file is made up of a number of named sections each of which
contains a number of configuration items.  The format of a configuration file
is as follows:

- a section name is a single line with the name enclosed between ``[`` and
  ``]``

- a configuration item is a single line containing a name/value pair separated
  by ``=``

- values may be extended to lines immediately following if they are indented by
  at least one space

- a value may include another value by embedding the name of that value
  enclosed between ``%(`` and ``)``

- comments begin with ``#`` and continue to the end of the line

- blank lines are ignored.

Those configuration items that appear before the first section name are
automatically added to all sections.

A configuration file defines a section for each version of Qt that requires a
different configuration.  :program:`configure.py` will choose the most
appropriate section according to the version of Qt you are actually using.  For
example, if a configuration file contains sections for Qt v5.3 and Qt v5.1 and
you are using Qt v5.2.1 then the section for Qt v5.1 will be chosen.

:program:`configure.py` provides the following preset values for a
configuration:

``py_major``
    is the major version number of the target Python installation.

``py_minor``
    is the minor version number of the target Python installation.

``sysroot``
    is the name of the system root directory.  This is specified with the
    :option:`--sysroot` option.

The following is an example configuration file::

    # The target Python installation.
    py_platform = linux
    py_inc_dir = %(sysroot)/usr/include/python%(py_major).%(py_minor)
    py_pylib_dir = %(sysroot)/usr/lib/python%(py_major).%(py_minor)/config
    py_pylib_lib = python%(py_major).%(py_minor)mu

    # The target PyQt installation.
    pyqt_module_dir = %(sysroot)/usr/lib/python%(py_major)/dist-packages
    pyqt_bin_dir = %(sysroot)/usr/bin
    pyqt_sip_dir = %(sysroot)/usr/share/sip/PyQt5
    pyuic_interpreter = /usr/bin/python%(py_major).%(py_minor)
    pyqt_disabled_features = PyQt_Desktop_OpenGL PyQt_qreal_double

    # Qt configuration common to all versions.
    qt_shared = True

    [Qt 5.1]
    pyqt_modules = QtCore QtDBus QtDesigner QtGui QtHelp QtMultimedia
        QtMultimediaWidgets QtNetwork QtOpenGL QtPrintSupport QtQml QtQuick
        QtSensors QtSerialPort QtSql QtSvg QtTest QtWebKit QtWebKitWidgets
        QtWidgets QtXmlPatterns _QOpenGLFunctions_ES2

This example contains a section for Qt v5.1.  We have defined a number of
values before the start of the section as they are not specific to any
particular version of Qt.  Note that if you use this configuration with a
version of Qt earlier than v5.1 then you will get an error.

The following values can be specified in the configuration file:

``qt_shared``
    is set if Qt has been built as shared libraries.  The default value is
    ``False``.

``py_platform``
    is the target Python platform.

``py_debug``
    is set if a debug version of the target Python is being used.

``py_inc_dir``
    is the target Python include directory, i.e. the directory containing the
    ``Python.h`` file.

``py_pylib_dir``
    is the target Python library directory.

``py_pylib_lib``
    is the target Python interpreter library.  It should not include any
    platform-specific prefix or suffix.

``pyqt_disabled_features``
    is the space separated list of features (as defined by SIP's ``%Feature``
    directive) that should be disabled.

``pyqt_module_dir``
    is the target directory where the PyQt5 modules will be installed.  It can
    be overridden by the :option:`--destdir` option.

``pyqt_modules``
    is the space separated list of PyQt5 modules that will be built.  It can be
    overridden by the :option:`--enable` option.

``pyqt_bin_dir``
    is the name of the target directory where the PyQt5 related executables
    will be installed.  It can be overridden by the :option:`--bindir` option.

``pyqt_sip_dir``
    is the name of the target directory where the PyQt5 ``.sip`` files will be
    installed.  It can be overridden by the :option:`--sipdir` option.

``pyuic_interpreter``
    is the name of the Python interpreter (as it would be called from the
    target system) that will be used to run :program:`pyuic5`.  It can be
    overridden by the :option:`--pyuic5-interpreter` option.


Building PyQt5-related Projects
-------------------------------

The additional PyQt5 projects (i.e. PyQtWebEngine, PyQt3D, PyQtChart,
PyQtDataVisualization and PyQtPurchasing) are built and installed in exactly
the same way as PyQt5 itself.  In other words the source packages contain a
``configure.py`` script.
