Internationalisation of PyQt6 Applications
==========================================

PyQt6 and Qt include a comprehensive set of tools for translating applications
into local languages.  For a full description, see the Qt Linguist Manual in
the Qt documentation.

The process of internationalising an application comprises the following
steps.

- The programmer uses :program:`pylupdate6` to create or update a :file:`.ts`
  translation file for each human language that the application is to be
  translated into.  A :file:`.ts` file is an XML file that contains the
  messages to be translated and the corresponding translations that have
  already been made.  :program:`pylupdate6` can be run any number of times
  during development to update the :file:`.ts` files with the latest messages
  for translation.

- The translator uses Qt Linguist to update the :file:`.ts` files with
  translations of the messages.

- The release manager then uses Qt's :program:`lrelease` utility to convert the
  :file:`.ts` files to :file:`.qm` files which are compact binary equivalents
  used by the application.  If an application cannot find an appropriate
  :file:`.qm` file, or a particular message hasn't been translated, then the
  messages used in the original source code are used instead.


:program:`pylupdate6`
---------------------

The :program:`pylupdate6` utility is a command line interface to the
:sip:ref:`~PyQt6.lupdate` module.  The command has the following syntax::

    pylupdate6 [options] --ts .ts-file [--ts .ts-file ...] file [file ...]

The full set of command line options is:

.. program:: pylupdate6

.. cmdoption:: -h, --help

    A help message is written to ``stdout``.

.. cmdoption:: -V, --version

    The version number is written to ``stdout``.

.. cmdoption:: --exclude PATTERN

    a UNIX shell-style pattern that is matched against the source files found
    when recursively searching a directory.  If a source file matches then it
    is excluded.  This option may be specified any number of times.

.. cmdoption:: --no-obsolete

    All obsolete messages from the translation files will be discarded.  An
    obsolete message is one that was found by a previous invocation of
    :program:`pylupdate6` but has not been found by this invocation.  By
    default obsolete messages are retained and marked as such in the
    translation file.

.. cmdoption:: --no-summary

    A summary of updates to the translation files will not be displayed on
    ``stdout``.

.. cmdoption:: --ts FILE

    The name of a translation file that is created or updated with the
    translatable messages extracted from the source files.  This option may be
    specified any number of times.

.. cmdoption:: --verbose

    Progress messages will be displayed to ``stdout``.


The rest of the command line are the names of the :file:`.py` Python source
files and :file:`.ui` Designer files from which :program:`pylupdate6` extracts
messages from.

.. note::

    Each time you invoke :program:`pylupdate6` you should be careful to specify
    all the :file:`.py` and :file:`.ui` files that make up your application and
    not just the ones that have changed.  Otherwise any messages that appear in
    files that you don't specify will be marked as obsolete.


Differences Between PyQt6 and Qt
--------------------------------

Qt implements internationalisation support through the
:sip:ref:`~PyQt6.QtCore.QTranslator` class, and the
:sip:ref:`~PyQt6.QtCore.QT_TRANSLATE_NOOP`,
:sip:ref:`~PyQt6.QtCore.QCoreApplication.translate`,
:sip:ref:`~PyQt6.QtCore.QT_TR_NOOP` and :sip:ref:`~PyQt6.QtCore.QObject.tr`
methods.  Usually :sip:ref:`~PyQt6.QtCore.QObject.tr` is used to obtain the
correct translation of a message.  The translation process uses a message
context to allow the same message to be translated differently.  In Qt
:sip:ref:`~PyQt6.QtCore.QObject.tr` is actually generated by :program:`moc` and
uses the hardcoded class name as the context.  On the other hand,
:sip:ref:`~PyQt6.QtCore.QApplication.translate` allows the context to be
specified explicitly.

Unfortunately, because of the way Qt implements
:sip:ref:`~PyQt6.QtCore.QObject.tr` it is not possible for PyQt6 to exactly
reproduce its behaviour.  The PyQt6 implementation of
:sip:ref:`~PyQt6.QtCore.QObject.tr` uses the class name of the instance as the
context.  The key difference, and the source of potential problems, is that the
context is determined dynamically in PyQt6, but is hardcoded in Qt.  In other
words, the context of a translation may change depending on an instance's class
hierarchy.  For example::

    class A(QObject):
        def hello(self):
            return self.tr("Hello")

    class B(A):
        pass

    a = A()
    a.hello()

    b = B()
    b.hello()

In the above the message is translated by ``a.hello()`` using a context of
``A``, and by ``b.hello()`` using a context of ``B``.  In the equivalent C++
version the context would be ``A`` in both cases.

The PyQt6 behaviour is unsatisfactory and may be changed in the future.  It is
recommended that :sip:ref:`~PyQt6.QtCore.QCoreApplication.translate` be used in
preference to :sip:ref:`~PyQt6.QtCore.QObject.tr`.  This is guaranteed to work
with current and future versions of PyQt6 and makes it much easier to share
message files between Python and C++ code.  Below is the alternative
implementation of ``A`` that uses
:sip:ref:`~PyQt6.QtCore.QCoreApplication.translate`::

    class A(QObject):
        def hello(self):
            return QCoreApplication.translate('A', "Hello")


Support for Translator Comments
-------------------------------

In the same way that Qt's :program:`lupdate` can extract C++ comments aimed at
the translator, :program:`pylupdate6` can extract similarly formatted Python
comments.  Specifically:

    **#:** introduces a general comment for the translator

    **#=** introduces a unique identifier attached to the message

    **#~** introduces a field name and field contents attached to the message.
