.. sip:class-description::
    :status: todo
    :brief: Proxy class for presenting data in item models with Q3DSurface
    :digest: 49e58944bb1ca5e00e147323b7ded117

Proxy class for presenting data in item models with :sip:ref:`~PyQt6.QtDataVisualization.Q3DSurface`.

:sip:ref:`~PyQt6.QtDataVisualization.QItemModelSurfaceDataProxy` allows you to use :sip:ref:`~PyQt6.QtCore.QAbstractItemModel` derived models as a data source for :sip:ref:`~PyQt6.QtDataVisualization.Q3DSurface`. It uses the defined mappings to map data from the model to rows, columns, and surface points of :sip:ref:`~PyQt6.QtDataVisualization.Q3DSurface` graph.

Data is resolved asynchronously whenever the mapping or the model changes. :sip:ref:`~PyQt6.QtDataVisualization.QSurfaceDataProxy.arrayReset` is emitted when the data has been resolved. However, when :sip:ref:`~PyQt6.QtDataVisualization.QItemModelSurfaceDataProxy.useModelCategories` property is set to ``true``, single item changes are resolved synchronously, unless the same frame also contains a change that causes the whole model to be resolved.

Mappings can be used in the following ways:

* If :sip:ref:`~PyQt6.QtDataVisualization.QItemModelSurfaceDataProxy.useModelCategories` property is set to ``true``, this proxy will map rows and columns of :sip:ref:`~PyQt6.QtCore.QAbstractItemModel` to rows and columns of :sip:ref:`~PyQt6.QtDataVisualization.Q3DSurface`, and uses the value returned for :sip:ref:`~PyQt6.QtCore.Qt.ItemDataRole.DisplayRole` as Y-position by default. Row and column headers are used for Z-position and X-position by default, if they can be converted to floats. Otherwise row and column indices are used. The Y-position role to be used can be redefined if :sip:ref:`~PyQt6.QtCore.Qt.ItemDataRole.DisplayRole` is not suitable. The Z-position and X-position roles to be used can be redefined if the headers or indices are not suitable.

* For models that do not have data already neatly sorted into rows and columns, such as :sip:ref:`~PyQt6.QtCore.QAbstractListModel` based models, you can define a role from the model to map for each of row, column and Y-position.

* If you do not want to include all data contained in the model, or the autogenerated rows and columns are not ordered as you wish, you can specify which rows and columns should be included and in which order by defining an explicit list of categories for either or both of rows and columns.

For example, assume that you have a custom :sip:ref:`~PyQt6.QtCore.QAbstractItemModel` storing surface topography data. Each item in the model has the roles "longitude", "latitude", and "height". The item model already contains the data properly sorted so that longitudes and latitudes are first encountered in correct order, which enables us to utilize the row and column category autogeneration. You could do the following to display the data in a surface graph:

.. literalinclude:: ../../../snippets/qtdatavis3d-src-datavisualization-doc-snippets-doc_src_qtdatavisualization.py
    :lines: 83-86

If the fields of the model do not contain the data in the exact format you need, you can specify a search pattern regular expression and a replace rule for each role to get the value in a format you need. For more information how the replace using regular expressions works, see QString::replace(const :sip:ref:`~PyQt6.QtCore.QRegularExpression` &rx, const QString &after) function documentation. Note that using regular expressions has an impact on the performance, so it's more efficient to utilize item models where doing search and replace is not necessary to get the desired values.

For example about using the search patterns in conjunction with the roles, see `ItemModelBarDataProxy <https://doc.qt.io/qt-6/qml-qtdatavisualization-itemmodelbardataproxy.html>`_ usage in `Qt Quick 2 Bars Example <https://doc.qt.io/qt-6/qtdatavisualization-qmlbars-example.html>`_.

.. seealso:: `Qt Data Visualization Data Handling <https://doc.qt.io/qt-6/qtdatavisualization-data-handling.html>`_.
